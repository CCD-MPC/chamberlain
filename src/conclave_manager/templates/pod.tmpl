{
    "apiVersion": "v1",
    "kind": "Pod",
    "metadata":
    {
        "name": "{{{POD_NAME}}}",
        "labels":
        {
            "app": "{{{POD_NAME}}}",
            "job_id": "{{{COMPUTE_ID}}}"
        }
    },
    "spec":
    {
        "selector":
        {
            "app": "{{{POD_NAME}}}"
        },
        "restartPolicy": "Never",
        "containers":
        [
            {
                "name": "{{{POD_NAME}}}",
                "image": "{{{IMAGE}}}",
                "ports":
                [
                    {
                        "containerPort": 5000,
                        "protocol": "TCP"
                    },
                    {
                        "containerPort": 5001,
                        "protocol": "TCP"
                    }
                ],
                "imagePullPolicy": "Always",
                "env":
                [
                    {
                        "name": "KUBECFG_PATH",
                        "value": "/tmp/.kube/config"
                    },
                    {
                        "name": "OPENSHIFTMGR_PROJECT",
                        "value": "{{{NAMESPACE}}}"
                    }
                ],
                "command":
                [
                    "./run.sh"
                ],
                "volumeMounts":
                [
                    {
                        "name": "config-volume-main",
                        "mountPath": "/etc/config"
                    },
                    {
                        "name": "data-volume",
                        "mountPath": "/data"
                    },
                    {
                        "name": "swift-auth",
                        "mountPath": "/etc/swift-auth"
                    }
                ]
            }
        ],
        "initContainers":
        [
            {
                "name": "init-{{{POD_NAME}}}",
                "image": "docker.io/bengetch/policy-engine:latest",
                "imagePullPolicy": "Always",
                "command":
                [
                    "./run.sh"
                ],
                "volumeMounts":
                [
                    {
                        "name": "config-volume-policy",
                        "mountPath": "/etc/init-config"
                    }
                ],
                "env":
                [
                    {
                        "name": "KUBECFG_PATH",
                        "value": "/tmp/.kube/config"
                    },
                    {
                        "name": "OPENSHIFTMGR_PROJECT",
                        "value": "{{{NAMESPACE}}}"
                    }
                ]
            }
        ],
        "volumes":
        [
            {
                "name": "config-volume-main",
                "configMap":
                {
                    "name": "{{{CONFIGMAP_NAME}}}",
                    "items":
                    [
                        {
                            "key": "protocol_encoded",
                            "path": "protocol"
                        },
                        {
                            "key": "conf_encoded",
                            "path": "conf"
                        },
                        {
                            "key": "in_conf_encoded",
                            "path": "in_conf"
                        },
                        {
                            "key": "out_conf_encoded",
                            "path": "out_conf"
                        }
                    ]
                }
            },
            {
                "name": "config-volume-policy",
                "configMap":
                {
                    "name": "{{{CONFIGMAP_NAME}}}",
                    "items":
                    [
                        {
                            "key": "protocol_policy_encoded",
                            "path": "protocol_policy"
                        },
                        {
                            "key": "in_conf_encoded",
                            "path": "in_conf"
                        }
                    ]
                }
            },
            {
                "name": "swift-auth",
                "configMap":
                {
                    "name": "swift-auth",
                    "items":
                    [
                        {
                            "key": "osAuthUrl",
                            "path": "auth_url"
                        },
                        {
                            "key": "username",
                            "path": "username"
                        },
                        {
                            "key": "password",
                            "path": "password"
                        }
                    ]
                }
            },
            {
                "name": "data-volume",
                "emptyDir": {}
            }
        ]
    }
}